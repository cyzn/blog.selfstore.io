---
layout: post
title: 关于 QQ 邮箱无法收到系统邮件的问题
---

\*下文包括一些技术细节，不过会描述得尽可能简单。对技术细节不感兴趣的可跳到 **临时解决办法** 一节。

最近有顾客反馈 QQ 邮箱无法收到 SelfStore 的订单邮件和用户确认邮件，且垃圾邮件箱也没有，SelfStore 的邮件发送服务的日志也记录了这一情况，只要是发往 QQ 邮箱的邮件都会有 550 错误：

> Server response: 550 550 Ip frequency limited. http://service.mail.qq.com/cgi-bin/help?subtype=1&&id=20022&&no=1000725

这个问题产生的原因是 QQ 邮箱的垃圾邮箱过滤机制针对 IP 发送量设了限制，而 SelfStore 使用的 Mailgun 发送服务分配的是共享 IP，即使 SelfStore 本身发送的邮件量非常少也可能触发限制。SelfStore 不是唯一碰到此问题的网站，所有初创服务都可能遇到 QQ 邮箱拒收的问题，例如这篇文章提到的情况：《[关于邮件](http://weibo.com/p/1001603727504811684569)》。

发现了问题后，我开始想办法解决，主要思路是让发往 QQ 邮箱的邮件通过国内针对 QQ 送达率高的服务发送，包括：

1. SendCloud
2. QQ 企业邮箱

本来 SendCould 是一个不错的选择，没想到 SendCloud 最近改为了只接受企业用户付费，SelfStore 暂时无法满足条件，而免费用户每天只能往 QQ 邮箱发送 10 封邮件。于是我给 SendCloud 客服询问个人用户是否能付费，但是没有回复，所以这个路线暂时无法进行。

然后开始尝试 QQ 企业邮箱，经过一天开发成功在程序上区分了发往 QQ 邮箱的线路。但这也是有限制的，QQ 企业邮箱每天只能外发 500 封邮件，虽然目前 SelfStore 的订单邮件还远没有达到这个量，但这意味着不能用来发送更新通知（一次更新可能发送几十上百封，只对顾客发送，可退订），这样使用 QQ 邮箱下单的顾客就享受不到更新提醒这个售后服务。

经过几天折腾后，我发现这个问题没有完美的解决办法，因为问题根源在于 QQ 邮箱的垃圾过滤机制太简单粗暴，换用国内邮件发送服务也不能确保将来不被拒收，这只有 QQ 邮箱团队改进他们的垃圾过滤机制才能根本解决。

现在面临的选择是，要不让使用 QQ 邮箱的顾客正常购买但收不到更新提醒，要不在下单时提醒不要用 QQ 邮箱。几番思考，我觉得后一个方案更好，虽然这这对 QQ 邮箱用户不公平，但也免得给将来出现问题埋下隐患。

现在在下单页面会看到一条提醒：

![](/images/posts/2014-07-03-qq-mail-problem/qq.png)

## 临时解决办法

这不意味放弃了 QQ 邮箱用户，或者之前使用 QQ 邮箱下单的用户失去了更新通知的服务，但需要 QQ 邮箱用户做一些额外设置，方法就是把 `selfstore.io` 添加到个人邮箱设置的域名白名单里。

位置在于：邮箱设置-反垃圾-设置域名白名单。

![](/images/posts/2014-07-03-qq-mail-problem/white-list.png)

添加域名白名单后即可正常收到 SelfStore 发送的系统邮件。

## 对下单率的影响

卖家关心的问题，这肯定会影响将 QQ 邮箱作为唯一常用邮箱的潜在用户的下单率。不过从已有的下单邮件比率来看，并不是无法承受的，现有比率为：

1. Gmail 47.4%
2. QQ 17.3%
3. 163 14.3%
4. 126 4.4%
5. 其他

也就是约有 17.3% 的潜在顾客会受影响。虽然 SelfStore 很想服务每一位顾客，但目前实在拿 QQ 邮箱没办法。SelfStore 还有很多的功能要实现，例如评价、讨论区、在线阅读……在 QQ 邮箱上已经花费了不少时间，却找不到很好的解决方法，只能暂时放置这个问题。

现在系统依然会向 QQ 邮箱发信，未来也会继续观察 QQ 邮箱的送达情况，如果情况有好转，或者有其他解决方法，到时 QQ 邮箱的警告会被移除。

衷心希望国内占有率最大的 QQ 邮箱能改进垃圾过滤算法。
